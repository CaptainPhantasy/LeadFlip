{
  "$schema": "https://railway.app/railway.schema.json",
  "version": "2",
  "services": {
    "websocket-server": {
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.websocket"
      },
      "deploy": {
        "startCommand": "node dist/server/websocket-server.js",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 100,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
      },
      "env": {
        "NODE_ENV": "production",
        "WEBSOCKET_PORT": "8080"
      },
      "healthcheck": {
        "path": "/health",
        "interval": 30,
        "timeout": 5
      },
      "regions": [
        "us-east"
      ],
      "scale": {
        "minInstances": 1,
        "maxInstances": 3,
        "cpuThreshold": 80,
        "memoryThreshold": 85
      }
    },
    "call-worker": {
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.worker"
      },
      "deploy": {
        "startCommand": "node dist/server/workers/call-worker.js",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
      },
      "env": {
        "NODE_ENV": "production"
      },
      "regions": [
        "us-east"
      ],
      "scale": {
        "minInstances": 1,
        "maxInstances": 5,
        "cpuThreshold": 70,
        "memoryThreshold": 80
      }
    }
  }
}
